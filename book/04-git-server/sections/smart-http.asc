=== Smart HTTP

(((serving repositories, HTTP)))
通过 `git://` 进行的无鉴权访问 或 SSH，我们现在拥有鉴权访问，但是现在还有一个协议可以同时实现上述两种可能。
设立 Smart HTTP 一般只需要在服务器上开启一个由 Git 提供的名为 `git-http-backend` 的 CGI 脚本。((git commands, "http-backend"))
该 CGI 将会读取路径和头部信息，该请求由 `git fetch` 或 `git push` 发送至一个 HTTP URL 并确定该客户端是否允许通过 HTTP 进行通信（在版本号大于 1.6.6 的任何客户端下是可行的）。
如果 CGI 发现该客户端是智能的，它将会以智能模式与它进行通信，否则它将会回落到非智能模式下（因此它可以针对某些老的客户端实现向下兼容）。

经过一个最基本的安装步骤，我们将可通过使用 Apache 作为 CGI 服务器来设立它。如果你不想使用 Apache，你仍旧可以在 Linux 环境下使用类似于此的命令来实现：(((Apache)))

[source,console]
----
$ sudo apt-get install apache2 apache2-utils
$ a2enmod cgi alias env
----

该操作将会启用 `mod_cgi`, `mod_alias`, 和 `mod_env` 模块, 这些都是让该功能正常工作所必须的。

接下来我们需要添加一些内容至 Apache 配置档中来运行 `git http-backend` 作为后端，以针对任何通过你的 Web 服务器进行 `/git` 路径请求的访问.

[source,console]
----
SetEnv GIT_PROJECT_ROOT /opt/git
SetEnv GIT_HTTP_EXPORT_ALL
ScriptAlias /git/ /usr/libexec/git-core/git-http-backend/
----

当你留空 `GIT_HTTP_EXPORT_ALL` 环境变量，Git 将只针对无鉴权客户端处理仓库目录中存在 `git-daemon-export-ok` 的情况，就像 Git 守护进程所做的那样。

接着你需要让 Apache 接受通过该路径的请求，添加如下的内容：

[source,console]
----
<Directory "/usr/lib/git-core*">
   Options ExecCGI Indexes
   Order allow,deny
   Allow from all
   Require all granted
</Directory>
----

最后你如果想以某种方式实现在鉴权验证的情况下进行写操作，使用一个如下的鉴权屏蔽配置即可：

[source,console]
----
<LocationMatch "^/git/.*/git-receive-pack$">
    AuthType Basic
    AuthName "Git Access"
    AuthUserFile /opt/git/.htpasswd
    Require valid-user
</LocationMatch>
----

浙江需要你创建一个包含所有合法用户密码的 `.htaccess` 文件。以下是一个添加 ``schacon'' 用户到该文件的例子：

[source,console]
----
$ htdigest -c /opt/git/.htpasswd "Git Access" schacon
----

可以通过许多方式添加 Apache 鉴权用户，你可以选择使用其中一种方式。这仅仅只是我们可以找到的最简单的一个例子。如果你愿意的话，你也可以通过 SSL 运行它以保证所有数据是在加密状态下被传输的。

我们不想深入下去详细讲解 Apache 配置档，因为你可以使用不同的服务器或者有不同的鉴权需求。主要思想是 Git 附带了一个名为 `git http-backend` 的 CGI，其可被引用来进行处理协商并通过 HTTP 发送和接受数据。它本身并不包含任何鉴权功能，但是该功能可以轻松在 Web 服务器层引用它时被实现。你可以在几乎任何可以处理 CGI 的 Web 服务器上办到它，所以随便挑一个你最熟悉的 Web 服务器下手吧。

[NOTE]
====
欲了解更多的有关配置 Apache 鉴权访问的信息，请点此浏览 Apache 文档： http://httpd.apache.org/docs/current/howto/auth.html[]
====
